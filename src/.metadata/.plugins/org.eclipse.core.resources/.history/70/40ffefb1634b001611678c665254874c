package application ;

import java.sql.Connection ;
import java.sql.DriverManager ;
import java.sql.ResultSet ;
import java.sql.SQLException ;
import java.sql.Statement ;

import javafx.collections.FXCollections ;
import javafx.collections.ObservableList ;
import javafx.scene.control.Label ;

/**
 * Final class because it must not be inherited
 */
public class BddRecipe
{
	Label label ;
	String string ;
	private ObservableList<Recipe> dataRecipe ;
	
	public Connection getConnection() throws ClassNotFoundException, SQLException
	{       
        Class.forName( "com.mysql.jdbc.Driver" ) ;
        return DriverManager.getConnection( "jdbc:mysql://localhost:3306/CookieSCookout" , "root" , "root" ) ; 
	} ;
	
	/**
	 * Save in BDD Recipe
	 * @param imgRecipe
	 * @param titleRecipe
	 * @param contentRecipe
	 * @param scoreRecipe
	 * @param pollRecipe
	 * @param urlRecipe
	 * @return
	 */
	public String saveInBDDRecipe
   		( 
		   String imgRecipe , String titleRecipe  , String contentRecipe , 
		   int scoreRecipe , int pollRecipe , String urlRecipe 
		)
	{
		Connection cn = null ;
 		Statement st = null ;
 		
 		try
 		{
 			cn = getConnection() ;
 			st = cn.createStatement() ;
 			String sql = "INSERT INTO Recipe ( imgRecipe , titleRecipe , contentRecipe , scoreRecipe , pollRecipe , urlRecipe ) "
 					+ " VALUES (\" " + imgRecipe + "\",\"" + titleRecipe + "\",\"" + contentRecipe +  "\",\"" 
 					+ scoreRecipe + "\",\""  + pollRecipe + "\",\""  + urlRecipe +"\");" ;
 			st.executeUpdate( sql ) ;
 			string = new String( titleRecipe + " was successfuly saved in BDD!" ) ;
 		}
 		catch( SQLException e )
 		{
 			e.printStackTrace() ;
 			string = new String( "Error! Cannot saved in BDD!" ) ;
 		}
 		catch(ClassNotFoundException e)
 		{
 			e.printStackTrace() ;
 			string = new String( "Error! Cannot saved in BDD!" ) ;
 		}
 		finally
 		{
 			try
 			{
 				cn.close() ;
 				st.close() ;
 			}
 			catch( SQLException e )
 			{
 				e.printStackTrace() ;
 				string = new String( "Error! Cannot close!" ) ;
 			}
 		}
		return string ;
 	} ;
	
 	
 	/**
 	 * Update in BDD Recipe
 	 * @param idRecipe
 	 * @param imgRecipe
 	 * @param titleRecipe
 	 * @param contentRecipe
 	 * @param scoreRecipe
 	 * @param pollRecipe
 	 * @param urlRecipe
 	 * @return
 	 */
 	public String updateInBDDRecipe
 		(
 			int idRecipe , String imgRecipe , String titleRecipe , 
 			String contentRecipe , int scoreRecipe , int pollRecipe , String urlRecipe 
 		)
 	{
 		Connection cn = null ;
 		Statement st = null ;
 		
 		try
 		{
 			cn = getConnection() ;
 			st = cn.createStatement() ;
 			String sql = "UPDATE Recipe SET "
 					+ " img = \"" + imgRecipe + "\" , "
 					+ "title = \"" + titleRecipe + "\" , "
 					+ "recipe = \"" + contentRecipe + "\" , "
 					+ "score = " + scoreRecipe + ", "
 					+ "poll = " + pollRecipe + ", "
 					+ "url = \"" + urlRecipe + "\" "
 					+ " where id = " + idRecipe + ";" ;
 			st.executeUpdate( sql ) ;
 			string = new String( titleRecipe + " was successfuly updated in BDD!" ) ;
 		}
 		catch( SQLException e )
 		{
 			e.printStackTrace() ;
 			string = new String( "Error! Cannot updated in BDD!" ) ;
 		}
 		catch(ClassNotFoundException e)
 		{
 			e.printStackTrace() ;
 			string = new String( "Error! Cannot updated in BDD!" ) ;
 		}
 		finally
 		{
 			try
 			{
 				cn.close() ;
 				st.close() ;
 			}
 			catch( SQLException e )
 			{
 				e.printStackTrace() ;
 				string = new String( "Error! Cannot close!" ) ;
 			}
 		}
		return string ;
 	} ;
 	
	/**
	 * Get From BDD Recipe
	 */
	public ObservableList<Recipe> getFromBDDRecipe()
	{
		dataRecipe = FXCollections.observableArrayList() ;
		Connection cn = null ;
		Statement st = null ;
		ResultSet rs = null ;
		
		try
		{
			cn = getConnection() ;
			st = cn.createStatement() ;
			String sql = "SELECT * FROM Recipe" ;
			rs = st.executeQuery( sql ) ;
			
			while( rs.next() )
			{
				Recipe rec = new Recipe() ;
				rec.setIdRecipe(rs.getString( "idRecipe" ) ) ;
				rec.setImgRecipe( rs.getString( "imgRecipe" ) ) ;
				rec.setTitleRecipe( rs.getString( "titleRecipe" ) ) ;
				rec.setContentRecipe(  rs.getString( "contentRecipe" ) ) ;
				rec.setScoreRecipe( rs.getString( "scoreRecipe" ) ) ;
				rec.setPollRecipe( rs.getString( "pollRecipe" ) ) ;
				rec.setUrlRecipe( rs.getString( "urlRecipe" ) ) ;
				dataRecipe.add( rec ) ;
			}
		}
		catch( SQLException e )
		{
			e.printStackTrace() ;
			System.out.println( "Error on Building Data" ) ;
		}
		catch( ClassNotFoundException e )
		{
			e.printStackTrace() ;
			System.out.println( "Error on Building Data" ) ;
		}
		finally
		{
			try
			{
				cn.close() ;
				st.close() ;
			}
			catch(SQLException e)
			{
				e.printStackTrace() ;
				System.out.println( "Error! Cannot close!" ) ;
			}
		}
		
		return data ;
	} ;
	
	/**
	 * Delete inBDD Recipe
	 * @param toDelete
	 * @param titleToDelete
	 * @return
	 */
	public String deleteInBDD (int toDelete , String titleToDelete)
	{
		Connection cn = null ;
		Statement st = null ;
				
		try
		{
			cn = getConnection() ;
			st = cn.createStatement() ;
			//String sql = "DELETE FROM Recipe WHERE id='" + toDelete + "';" ;
			String sql = "DELETE FROM COMPOSE WHERE idRecipe = \"" + toDelete + "\";" 
					   + "DELETE FROM Recipe  WHERE idRecipe = \"" + toDelete + "\";" ;
			st.executeUpdate( sql ) ;
			string = new String( titleToDelete + " was successfuly deleted from BDD!" ) ;
		}
		catch( SQLException e )
		{
			e.printStackTrace() ;
			string = new String( "Error! Cannot delete!" ) ;
		}
		catch( ClassNotFoundException e )
		{
			e.printStackTrace() ;
			string = new String( "Error! Cannot delete!" ) ;
		}
		finally
		{
			try
			{
				cn.close() ;
				st.close() ;
			}
			catch( SQLException e )
			{
				e.printStackTrace() ;
				string = new String( "Error! Cannot delete!" ) ;
			}
		}
		
		return string ;
	} ;
	
	
	
} ;


